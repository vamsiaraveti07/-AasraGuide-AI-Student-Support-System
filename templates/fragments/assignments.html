<style>
/* Animations */
@keyframes slideIn {
    from { opacity: 0; transform: translateY(-10px); }
    to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
/* Main Container */
.assignment-container {
    padding: 24px;
    background: linear-gradient(135deg, #0a1118 0%, #0f1923 100%);
    border-radius: 16px;
    max-height: 85vh;
    overflow-y: auto;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    animation: fadeIn 0.3s;
}
/* Header */
.assignment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 20px;
    border-bottom: 2px solid rgba(14, 165, 107, 0.2);
}
.assignment-header h2 {
    color: #eaf3ff;
    font-size: 1.8rem;
    margin: 0;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 12px;
}
.assignment-header h2 i {
    color: #0ea56b;
    font-size: 1.6rem;
}
/* Buttons */
.btn {
    padding: 12px 20px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    color: white;
    font-size: 0.95rem;
    font-weight: 600;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}
.btn-primary    { background: linear-gradient(135deg,#0ea56b 0%,#0c8f5d 100%); }
.btn-secondary  { background: linear-gradient(135deg,#6c757d 0%,#5a6268 100%); }
.btn-danger     { background: linear-gradient(135deg,#dc3545 0%,#c82333 100%); }
.btn-info       { background: linear-gradient(135deg,#2c7be5 0%,#1a5fc7 100%); }
.btn:active     { transform: scale(0.95); }
.btn-primary:hover  { box-shadow: 0 6px 20px rgba(14,165,107,0.5); transform: translateY(-2px);}
.btn-secondary:hover{ box-shadow: 0 6px 20px rgba(108,117,125,0.4);}
.btn-danger:hover   { box-shadow: 0 6px 20px rgba(220,53,69,0.5);}
.btn-info:hover     { box-shadow: 0 6px 20px rgba(44,123,229,0.5);}
/* Form Styling */
.form-box {
    background: linear-gradient(135deg,rgba(14,165,107,0.05) 0%,rgba(14,165,107,0.1) 100%);
    padding: 24px;
    border-radius: 12px;
    margin-bottom: 24px;
    border: 2px solid rgba(14,165,107,0.3);
    box-shadow: 0 4px 20px rgba(14,165,107,0.1);
    animation: slideIn 0.3s;
}
.form-row        { margin-bottom: 18px; }
.form-row label  { display: block; color: #b8c5d6; margin-bottom: 8px; font-size: .95rem; font-weight: 600; }
.form-row input,
.form-row textarea,
.form-row select {
    width: 100%;
    padding: 12px 16px;
    border-radius: 10px;
    background: rgba(12,18,27,0.8);
    border: 2px solid rgba(255,255,255,0.1);
    color: white;
    font-size: 0.95rem;
    box-sizing: border-box;
}
.form-row textarea { min-height: 100px; resize: vertical; }
.form-buttons      { display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px; }
/* Assignment Cards/List */
.list-item {
    background: linear-gradient(135deg,rgba(255,255,255,0.03) 0%,rgba(255,255,255,0.06) 100%);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.08);
    margin-bottom: 14px;
    position: relative;
    transition: all 0.3s;
}
.list-item.overdue {
    border-left: 4px solid #dc3545;
    background: linear-gradient(135deg,rgba(220,53,69,0.08) 0%,rgba(220,53,69,0.12) 100%);
}

.item-title {
    color: #eaf3ff; font-size: 1.2rem; font-weight: 700; margin-bottom: 10px;
    display: flex; align-items: center; gap: 10px;
}
.item-meta  { color:#8b9bb0; font-size: .88rem; margin-bottom: 10px; display: flex; gap: 16px; flex-wrap: wrap;}
.item-notes { color:#b8c5d6; font-size: .92rem; margin-bottom: 14px; padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; border-left: 3px solid rgba(14,165,107,0.3);}
.item-buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-top:7px; }
/* Badges */
.priority-badge {
    display: inline-block; border-radius: 12px; font-size: .88rem; font-weight:700;
    padding: 4px 12px; margin-left: 9px; text-transform: uppercase;
}
.priority-high   { background: #dc3545; color: white; }
.priority-medium { background: #ffc107; color: #222; }
.priority-low    { background: #28a745; color: white; }
.status-badge {
    display: inline-block; border-radius: 12px; font-size: .88rem; font-weight: 700;
    padding: 4px 12px; margin-left: 7px; text-transform: capitalize;
}
.status-not_started { background: #adb5bd; color: #222; }
.status-in_progress { background: #5a9aff; color: #fff; }
.status-completed   { background: #28a745; color: #fff; }
.overdue-badge {
    display: inline-block; background: #dc3545; color: white;
    padding: 4px 10px; border-radius: 12px; font-size: .75rem; font-weight: 700; margin-left: 8px;
}
/* Progress Bar */
.progress-bar-container {
    width: 100%; height: 8px; background: rgba(255,255,255,0.1);
    border-radius: 10px; overflow: hidden; margin: 8px 0;
}
.progress-bar {
    height: 100%; background: linear-gradient(90deg,#0ea56b 0%,#5cd684 100%);
    transition: width 0.3s; border-radius: 10px;
}
.empty {
    text-align:center; padding:60px 20px; color:#8b9bb0;
}
.empty i {font-size:4rem;opacity:0.2;margin-bottom:20px;display:block;}
.empty p {margin-top:16px;font-size:1.1rem;color:#b8c5d6;}
.hide { display:none !important;}
/* Calendar View */
#calendarView { margin-top: 30px;}
</style>
<div class="assignment-container">
  <div class="assignment-header">
    <h2><i class="fa-solid fa-book-open"></i> My Assignments</h2>
    <button class="btn btn-primary" id="addBtn">
      <i class="fa-solid fa-plus-circle"></i> New Assignment
    </button>
  </div>

  <!-- Form -->
  <div id="formBox" class="form-box hide">
    <h3 id="formTitle">New Assignment</h3>
    <div class="form-row">
      <label><i class="fa-solid fa-heading"></i> Title *</label>
      <input type="text" id="title" placeholder="e.g.,Normalization in DBMS">
    </div>
    <div class="form-row">
      <label><i class="fa-solid fa-tag"></i> Subject</label>
      <input type="text" id="subject" placeholder="e.g.,DBMS">
    </div>
    <div class="form-row">
      <label><i class="fa-solid fa-calendar-days"></i> Due Date</label>
      <input type="date" id="dueDate">
    </div>
    <div class="form-row">
      <label><i class="fa-solid fa-signal"></i> Priority</label>
      <select id="priority">
        <option value="high">High</option>
        <option value="medium" selected>Medium</option>
        <option value="low">Low</option>
      </select>
    </div>
    <div class="form-row">
      <label><i class="fa-solid fa-spinner"></i> Status</label>
      <select id="status">
        <option value="not_started" selected>Not Started</option>
        <option value="in_progress">In Progress</option>
        <option value="completed">Completed</option>
      </select>
    </div>
    <div class="form-row">
      <label><i class="fa-solid fa-chart-line"></i> Progress: <span id="progressValue">0</span>%</label>
      <input type="range" id="progress" min="0" max="100" value="0" oninput="document.getElementById('progressValue').innerText = this.value">
    </div>
    <div class="form-row">
      <label><i class="fa-solid fa-pen-to-square"></i> Notes</label>
      <textarea id="notes" placeholder="Add any additional details..."></textarea>
    </div>
    <div class="form-buttons">
      <button class="btn btn-secondary" id="cancelBtn">
        <i class="fa-solid fa-xmark"></i> Cancel
      </button>
      <button class="btn btn-primary" id="saveBtn">
        <i class="fa-solid fa-check"></i> Save Assignment
      </button>
    </div>
  </div>

  <!-- Assignment list -->
  <div id="itemList">
    {% if assignments|length == 0 %}
      <div class="empty">
        <i class="fa-solid fa-clipboard-list"></i>
        <p>No assignments yet. Click "New Assignment" to get started!</p>
      </div>
    {% else %}
      {% for a in assignments %}
        <div class="list-item {% if a.due_date and a.due_date < today %}overdue{% endif %}" data-id="{{ a.id }}">
          <div class="item-title">
            {{ a.title }}
            <span class="priority-badge priority-{{ a.priority if a.priority else 'medium' }}">{{ (a.priority if a.priority else 'medium').capitalize() }}</span>
            <span class="status-badge status-{{ a.status if a.status else 'not_started' }}">{{ (a.status if a.status else 'not_started').replace("_", " ").capitalize() }}</span>
            {% if a.due_date and a.due_date < today %}
              <span class="overdue-badge">OVERDUE</span>
            {% endif %}
          </div>
          <div class="item-meta">
            {% if a.subject %}
              <span><i class="fa-solid fa-tag"></i> {{ a.subject }}</span>
            {% endif %}
            {% if a.due_date %}
              <span><i class="fa-solid fa-calendar"></i> Due: {{ a.due_date.strftime('%b %d, %Y') }}</span>
            {% endif %}
            <span><i class="fa-solid fa-clock"></i> Created: {{ a.created_at.strftime('%b %d') }}</span>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar" style="width:{{ a.progress if a.progress else 0 }}%"></div>
          </div>
          {% if a.notes %}
            <div class="item-notes">{{ a.notes }}</div>
          {% endif %}
          <div class="item-buttons">
            <button class="btn btn-info btn-edit" data-id="{{ a.id }}">
              <i class="fa-solid fa-pen"></i> Edit
            </button>
            <button class="btn btn-danger btn-delete" data-id="{{ a.id }}">
              <i class="fa-solid fa-trash"></i> Delete
            </button>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  </div>
</div>

<script>
function initAssignmentsPage() {
    window.assignmentEditId = null;
    setTimeout(function() {
        const addBtn = document.getElementById('addBtn');
        const saveBtn = document.getElementById('saveBtn');
        const cancelBtn = document.getElementById('cancelBtn');

        // Show the Add form
        if (addBtn) {
            addBtn.onclick = function() {
                const formBox = document.getElementById('formBox');
                if (formBox) {
                    formBox.classList.remove('hide');
                    document.getElementById('formTitle').textContent = 'New Assignment';
                    document.getElementById('title').value = '';
                    document.getElementById('subject').value = '';
                    document.getElementById('dueDate').value = '';
                    document.getElementById('priority').value = 'medium';
                    document.getElementById('status').value = 'not_started';
                    document.getElementById('progress').value = 0;
                    document.getElementById('progressValue').innerText = '0';
                    document.getElementById('notes').value = '';
                    window.assignmentEditId = null;
                }
            }
        }
        // Hide the form (cancel)
        if (cancelBtn) {
            cancelBtn.onclick = function() {
                const formBox = document.getElementById('formBox');
                if (formBox) {
                    formBox.classList.add('hide');
                    window.assignmentEditId = null;
                }
            }
        }
        // Save (add or update)
        if (saveBtn) {
            saveBtn.onclick = async function() {
                const title = document.getElementById('title').value.trim();
                const subject = document.getElementById('subject').value.trim();
                const dueDate = document.getElementById('dueDate').value;
                const notes = document.getElementById('notes').value.trim();
                const priority = document.getElementById('priority').value;
                const status = document.getElementById('status').value;
                const progress = parseInt(document.getElementById('progress').value);

                if (!title) {
                    alert('Please enter a title');
                    return;
                }
                const data = { title, subject, due_date: dueDate, notes, priority, status, progress };
                const url = window.assignmentEditId ? `/api/assignments/${window.assignmentEditId}` : '/api/assignments';
                const method = window.assignmentEditId ? 'PUT' : 'POST';
                try {
                    const res = await fetch(url, {
                        method: method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    const result = await res.json();
                    if (result.ok || res.ok) {
                        alert('✓ Assignment saved successfully!');
                        location.reload();
                    } else {
                        alert('Error: ' + (result.error || 'Failed to save'));
                    }
                } catch (err) {
                    alert('Error: ' + err.message);
                }
            }
        }
        // Edit buttons
        document.querySelectorAll('.btn-edit').forEach(function(btn) {
            btn.onclick = async function() {
                const id = parseInt(this.getAttribute('data-id'));
                try {
                    const res = await fetch('/api/assignments');
                    const items = await res.json();
                    const item = items.find(a => a.id === id);
                    if (item) {
                        document.getElementById('title').value = item.title || '';
                        document.getElementById('subject').value = item.subject || '';
                        document.getElementById('dueDate').value = item.due_date || '';
                        document.getElementById('priority').value = item.priority || 'medium';
                        document.getElementById('status').value = item.status || 'not_started';
                        document.getElementById('progress').value = item.progress || 0;
                        document.getElementById('progressValue').innerText = item.progress || 0;
                        document.getElementById('notes').value = item.notes || '';
                        document.getElementById('formTitle').textContent = 'Edit Assignment';
                        document.getElementById('formBox').classList.remove('hide');
                        window.assignmentEditId = id;
                    }
                } catch (err) {
                    alert('Error loading assignment');
                }
            }
        });
        // Delete buttons
        document.querySelectorAll('.btn-delete').forEach(function(btn) {
            btn.onclick = async function() {
                const id = parseInt(this.getAttribute('data-id'));
                if (!confirm('Delete this assignment?')) return;
                try {
                    const res = await fetch(`/api/assignments/${id}`, { method: 'DELETE' });
                    const result = await res.json();
                    if (result.ok) {
                        alert('✓ Assignment deleted!');
                        location.reload();
                    }
                } catch (err) {
                    alert('Error deleting assignment');
                }
            }
        });
    }, 100);
}
</script>
